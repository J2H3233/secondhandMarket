<% 
    // ë ˆì´ì•„ì›ƒ ë³€ìˆ˜ ì„¤ì •
    title = 'ì±„íŒ…ë°© - ì¤‘ê³ ë§ˆì¼“';
    additionalCSS = ['/css/chatRoom.css'];
%>

<script src="/socket.io/socket.io.js"></script>

<style>
    /* --- ì¶”ê°€ëœ CSS ìŠ¤íƒ€ì¼ (ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ + ê¸°ëŠ¥ ì¶”ê°€) --- */
    
    /* ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆë¥¼ Flexboxë¡œ ì„¤ì •í•˜ì—¬ ì¢Œìš° ì •ë ¬ ê°€ëŠ¥í•˜ê²Œ í•¨ */
    .messages-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 20px;
        overflow-y: auto;
        background: #f5f7fb; /* ë°°ê²½ìƒ‰ ì‚´ì§ ë³€ê²½ */
    }

    /* ê³µí†µ ë§í’ì„  ìŠ¤íƒ€ì¼ */
    .message {
        max-width: 70%;
        padding: 10px 15px;
        border-radius: 15px;
        position: relative;
        font-size: 0.95rem;
        word-wrap: break-word;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ inside message */
    .message img {
        max-width: 100%;
        border-radius: 10px;
        margin-bottom: 5px;
        display: block;
    }

    /* 1. ë‚´ ë©”ì‹œì§€ (ì˜¤ë¥¸ìª½, ë…¸ë€ìƒ‰) */
    .message.sent {
        align-self: flex-end;
        background-color: #FFC107; /* ì¤‘ê³ ë§ˆì¼“ í¬ì¸íŠ¸ ì»¬ëŸ¬ */
        color: #333;
        border-bottom-right-radius: 2px;
    }

    /* 2. ìƒëŒ€ë°© ë©”ì‹œì§€ (ì™¼ìª½, íšŒìƒ‰) */
    .message.received {
        align-self: flex-start;
        background-color: #ffffff;
        border: 1px solid #eee;
        color: #333;
        border-top-left-radius: 2px;
    }

    /* ì‹œìŠ¤í…œ ë©”ì‹œì§€ (ì¤‘ì•™) */
    .message.system {
        align-self: center;
        background: rgba(0,0,0,0.05);
        color: #666;
        font-size: 0.8rem;
        padding: 5px 20px;
        border-radius: 20px;
        box-shadow: none;
    }

    /* ê±°ë˜ ìƒíƒœ ë³€ê²½ ìŠ¹ì¸ ìš”ì²­ (ì¤‘ì•™) */
    .message.status-request {
        align-self: center;
        background: #fff3cd;
        border: 1px solid #ffc107;
        color: #333;
        font-size: 0.9rem;
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        max-width: 80%;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .status-request-text {
        font-weight: bold;
        text-align: center;
    }

    .status-request-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
    }

    .status-request-btn {
        padding: 8px 20px;
        border: none;
        border-radius: 5px;
        font-size: 0.85rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
    }

    .status-request-btn.accept {
        background: #28a745;
        color: white;
    }

    .status-request-btn.accept:hover {
        background: #218838;
    }

    .status-request-btn.reject {
        background: #dc3545;
        color: white;
    }

    .status-request-btn.reject:hover {
        background: #c82333;
    }

    .status-request-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* ë°œì‹ ì ì´ë¦„ í‘œì‹œ */
    .message-sender {
        display: block;
        font-size: 0.75rem;
        font-weight: bold;
        margin-bottom: 3px;
        color: #555;
    }

    .message.sent .message-sender {
        text-align: right;
        color: #666;
    }

    .message.received .message-sender {
        text-align: left;
        color: #0066cc;
    }

    /* ì‹œê°„ í‘œì‹œ */
    .message-time {
        display: block;
        font-size: 0.7rem;
        color: #777; /* ê°€ë…ì„±ì„ ìœ„í•´ ìƒ‰ìƒ ì¡°ì • */
        margin-top: 4px;
        text-align: right;
    }

    /* í—¤ë” ì˜ì—­ ìˆ˜ì • (ì œëª© + ìƒíƒœë³€ê²½) */
    .chat-header {
        display: flex;
        justify-content: space-between; /* ì–‘ë ì •ë ¬ */
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
    }

    /* ê±°ë˜ ìƒíƒœ ì˜ì—­ */
    .trade-status-area {
        display: none; /* ë°© ì„ íƒ ì „ì—ëŠ” ìˆ¨ê¹€ */
        display: flex;
        align-items: center;
        gap: 10px;
    }

    /* ê±°ë˜ ìƒíƒœ ë“œë¡­ë‹¤ìš´ */
    .trade-status-select {
        padding: 5px 10px;
        border-radius: 20px;
        border: 1px solid #ddd;
        background: #fff;
        font-size: 0.85rem;
        font-weight: bold;
        cursor: pointer;
    }

    /* ìš”ì²­ ë²„íŠ¼ */
    .request-status-btn {
        padding: 6px 16px;
        border: none;
        border-radius: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-size: 0.85rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
    }

    .request-status-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .request-status-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* ì…ë ¥ì°½ ì˜ì—­ ìˆ˜ì • (ì´ë¯¸ì§€ ë²„íŠ¼ ì¶”ê°€) */
    .input-container {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .file-btn-label {
        font-size: 1.5rem;
        cursor: pointer;
        color: #888;
        transition: color 0.2s;
    }
    .file-btn-label:hover { color: #333; }
    #file-input { display: none; } /* ì‹¤ì œ íŒŒì¼ ì¸í’‹ì€ ìˆ¨ê¹€ */

    /* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° */
    #image-preview {
        display: none;
        padding: 10px;
        background: #f8f9fa;
        border-top: 1px solid #eee;
        position: relative;
    }
    #image-preview img {
        max-height: 100px;
        border-radius: 5px;
        border: 1px solid #ddd;
    }
    #preview-close {
        position: absolute;
        left: 100px; /* ì´ë¯¸ì§€ í¬ê¸°ì— ë”°ë¼ ì¡°ì • */
        top: 5px;
        background: red;
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        cursor: pointer;
        font-size: 12px;
        line-height: 18px;
        text-align: center;
    }
</style>

<div class="chat-page">
    <div class="chat-island">
        <div class="chat-container">
            
            <div class="room-list">
                <div class="room-list-header">
                    <h3>ì±„íŒ…ë°© ëª©ë¡</h3>
                </div>
                
                <div class="room-items-container">
                    <div class="room-item" data-room-id="room1">
                        <div class="room-name">í…ŒìŠ¤íŠ¸ ì±„íŒ…ë°©</div>
                        <div class="room-last-message">í…ŒìŠ¤íŠ¸</div>
                    </div>
                    <div class="room-item" data-room-id="room2">
                        <div class="room-name">í…ŒìŠ¤íŠ¸ ì±„íŒ…ë°©2</div>
                        <div class="room-last-message">í…ŒìŠ¤íŠ¸</div>
                    </div>
                </div>
            </div>

            <div class="chat-area">
                
                <div class="chat-header">
                    <h2 id="current-room-name">ì±„íŒ…ë°©ì„ ì„ íƒí•˜ì„¸ìš”</h2>
                    
                    <div class="trade-status-area" id="trade-status-area">
                        <select id="trade-status" class="trade-status-select">
                            <option value="PENDING">ğŸ¤ í˜‘ì˜ì¤‘</option>
                            <option value="IN_PERSON">ğŸš¶ ì§ê±°ë˜ìš”ì²­</option>
                            <option value="SHIPPING">ğŸšš ë°°ì†¡ìš”ì²­</option>
                            <option value="CANCELED">âŒ ê±°ë˜ì·¨ì†Œ</option>
                            <option value="COMPLETED">âœ… ê±°ë˜ì™„ë£Œ</option>
                        </select>
                        <button id="request-status-btn" class="request-status-btn">ìš”ì²­</button>
                    </div>
                </div>
                
                <div class="messages-container" id="messages-container">
                    <div class="no-room-selected" id="no-room-message">
                        <p style="text-align: center; color: #888; margin-top: 200px;">
                            ì±„íŒ…ë°©ì„ ì„ íƒí•˜ì—¬ ëŒ€í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”
                        </p>
                    </div>
                </div>
                
                <div class="input-area" id="input-area" style="display: none;">
                    
                    <div id="image-preview">
                        <img src="" id="preview-img" alt="preview">
                        <div id="preview-close" onclick="clearImage()">X</div>
                    </div>

                    <div class="input-container">
                        <label for="file-input" class="file-btn-label">ğŸ“·</label>
                        <input type="file" id="file-input" accept="image/*">

                        <input type="text" class="message-input" id="message-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." maxlength="1000">
                        <button class="send-btn" id="send-btn">ì „ì†¡</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const socket = io();

    // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë¡œê·¸ì¸ ì •ë³´
    <% if (user) { %>
    const myUserId = <%= user.userId %>;
    const myUserName = "<%= user.userName %>";
    <% } else { %>
    const myUserId = null;
    const myUserName = "ê²ŒìŠ¤íŠ¸";
    <% } %>

    let currentRoomId = null;
    let selectedImageBase64 = null; // ì„ íƒëœ ì´ë¯¸ì§€ ë°ì´í„° ì €ì¥
    let pendingStatusChange = null; // ëŒ€ê¸° ì¤‘ì¸ ìƒíƒœ ë³€ê²½ ìš”ì²­
    let currentStatus = 'PENDING'; // í˜„ì¬ ê±°ë˜ ìƒíƒœ

    // DOM ìš”ì†Œ
    const roomItems = document.querySelectorAll('.room-item');
    const messagesContainer = document.getElementById('messages-container');
    const currentRoomName = document.getElementById('current-room-name');
    const inputArea = document.getElementById('input-area');
    const messageInput = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-btn');
    const noRoomMessage = document.getElementById('no-room-message');
    
    const fileInput = document.getElementById('file-input');
    const imagePreview = document.getElementById('image-preview');
    const previewImg = document.getElementById('preview-img');
    const statusSelect = document.getElementById('trade-status');
    const statusArea = document.getElementById('trade-status-area');
    const requestStatusBtn = document.getElementById('request-status-btn');

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---

    // 1. ì±„íŒ…ë°© ì„ íƒ
    roomItems.forEach(item => {
        item.addEventListener('click', () => {
            const roomId = item.dataset.roomId;
            selectRoom(roomId, item);
        });
    });

    // 2. ë©”ì‹œì§€ ì „ì†¡
    sendBtn.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });

    // 3. ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸°
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                selectedImageBase64 = event.target.result;
                previewImg.src = selectedImageBase64;
                imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });

    // 4. ê±°ë˜ ìƒíƒœ ë³€ê²½ ìš”ì²­ ë²„íŠ¼ í´ë¦­
    requestStatusBtn.addEventListener('click', () => {
        const newStatus = statusSelect.value;
        
        // í˜„ì¬ ìƒíƒœì™€ ë™ì¼í•˜ë©´ ë¬´ì‹œ
        if (newStatus === currentStatus) {
            alert('í˜„ì¬ ìƒíƒœì™€ ë™ì¼í•©ë‹ˆë‹¤.');
            return;
        }
        
        if (currentRoomId) {
            // ì„œë²„ë¡œ ìƒíƒœ ë³€ê²½ ìš”ì²­ ì „ì†¡
            socket.emit('request_status_change', {
                room: currentRoomId,
                user: myUserId,
                userName: myUserName,
                status: newStatus,
                timestamp: new Date().toISOString()
            });
            
            // ë³¸ì¸ì—ê²Œë„ ìš”ì²­ ë©”ì‹œì§€ í‘œì‹œ
            addMessageToDOM({
                type: 'system',
                text: `ê±°ë˜ ìƒíƒœë¥¼ '${getStatusText(newStatus)}'(ìœ¼)ë¡œ ë³€ê²½ ìš”ì²­í–ˆìŠµë‹ˆë‹¤. ìƒëŒ€ë°©ì˜ ìˆ˜ë½ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...`
            });
            scrollToBottom();
        }
    });


    // --- ì†Œì¼“ ìˆ˜ì‹  (Server -> Client) ---

    // ë©”ì‹œì§€ ë°›ê¸°
    socket.on('receive_message', (data) => {
        if (data.room === currentRoomId) {
            // 1. ë‚´ê°€ ë³´ë‚¸ ë©”ì‹œì§€ì¸ì§€ í™•ì¸ (Sent vs Received)
            const type = (data.user === myUserId) ? 'sent' : 'received';
            
            addMessageToDOM({
                type: type,
                text: data.message,
                image: data.image, // ì´ë¯¸ì§€ ê²½ë¡œ ë˜ëŠ” Base64
                time: new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }),
                sender: data.userName || data.user // ë°œì‹ ì ì´ë¦„ ì¶”ê°€
            });
            scrollToBottom();
            
            // ì‚¬ì´ë“œë°”ì˜ ë§ˆì§€ë§‰ ë©”ì‹œì§€ ê°±ì‹  (ì´ë¯¸ì§€ì¸ ê²½ìš° 'ì‚¬ì§„'ìœ¼ë¡œ í‘œì‹œ)
            updateLastMessage(data.room, data.message || "ğŸ“· ì‚¬ì§„");
        }
    });

    // ê±°ë˜ ìƒíƒœ ë³€ê²½ ìš”ì²­ ë°›ê¸° (ìƒëŒ€ë°©ì´ ìš”ì²­í•œ ê²½ìš°)
    socket.on('receive_status_change_request', (data) => {
        if (data.room === currentRoomId && data.user !== myUserId) {
            pendingStatusChange = data; // ìš”ì²­ ì •ë³´ ì €ì¥
            
            // ìˆ˜ë½/ê±°ë¶€ ë²„íŠ¼ì´ ìˆëŠ” ë§í’ì„  ì¶”ê°€
            addStatusRequestMessageToDOM({
                requestId: data.timestamp,
                userName: data.userName,
                status: data.status,
                statusText: getStatusText(data.status)
            });
            scrollToBottom();
        }
    });

    // ê±°ë˜ ìƒíƒœ ë³€ê²½ ìŠ¹ì¸ ê²°ê³¼ ë°›ê¸°
    socket.on('status_change_response', (data) => {
        if (data.room === currentRoomId) {
            if (data.accepted) {
                // ìŠ¹ì¸ëœ ê²½ìš° - ìƒíƒœ ì—…ë°ì´íŠ¸
                currentStatus = data.status;
                statusSelect.value = data.status;
                addMessageToDOM({
                    type: 'system',
                    text: `ê±°ë˜ ìƒíƒœê°€ '${getStatusText(data.status)}'(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`
                });
            } else {
                // ê±°ë¶€ëœ ê²½ìš°
                addMessageToDOM({
                    type: 'system',
                    text: `ìƒëŒ€ë°©ì´ ê±°ë˜ ìƒíƒœ ë³€ê²½ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.`
                });
                // ë“œë¡­ë‹¤ìš´ì„ í˜„ì¬ ìƒíƒœë¡œ ë˜ëŒë¦¼
                statusSelect.value = currentStatus;
            }
            scrollToBottom();
        }
    });


    // --- ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ---

    function selectRoom(roomId, roomElement) {
        if (currentRoomId === roomId) return;

        // UI í™œì„±í™” ì²˜ë¦¬
        roomItems.forEach(item => item.classList.remove('active'));
        roomElement.classList.add('active');
        
        const roomName = roomElement.querySelector('.room-name').textContent;
        currentRoomName.textContent = roomName;
        
        inputArea.style.display = 'block';
        statusArea.style.display = 'flex'; // ìƒíƒœ ì˜ì—­ ë³´ì´ê¸°
        noRoomMessage.style.display = 'none';
        messagesContainer.innerHTML = ''; // ëŒ€í™”ë‚´ìš© ì´ˆê¸°í™”

        currentRoomId = roomId;
        currentStatus = 'PENDING'; // ì´ˆê¸° ìƒíƒœ (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ë°›ì•„ì™€ì•¼ í•¨)
        statusSelect.value = currentStatus;

        // ì†Œì¼“ ë°© ì…ì¥
        socket.emit('join_room', roomId);

        // ì‹œìŠ¤í…œ ë©”ì‹œì§€
        addMessageToDOM({
            type: 'system',
            text: `[${roomName}] ì±„íŒ…ë°©ì— ì…ì¥í–ˆìŠµë‹ˆë‹¤.`
        });
    }

    function sendMessage() {
        const text = messageInput.value.trim();

        // í…ìŠ¤íŠ¸ë‚˜ ì´ë¯¸ì§€ê°€ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ì „ì†¡
        if ((text || selectedImageBase64) && currentRoomId) {
            const messageData = {
                room: currentRoomId,
                user: myUserId,
                userName: myUserName, // ë°œì‹ ì ì´ë¦„ ì¶”ê°€
                message: text,
                image: selectedImageBase64 // ì´ë¯¸ì§€ ë°ì´í„° í¬í•¨
            };

            socket.emit('send_message', messageData);

            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            messageInput.value = '';
            clearImage();
            messageInput.focus();
        }
    }

    function clearImage() {
        fileInput.value = '';
        selectedImageBase64 = null;
        imagePreview.style.display = 'none';
    }

    function addMessageToDOM(msg) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', msg.type);
        
        let htmlContent = '';

        // 0. ë°œì‹ ì ì´ë¦„ (ì¼ë°˜ ë©”ì‹œì§€ì¼ ë•Œë§Œ, ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì œì™¸)
        if (msg.sender && msg.type !== 'system') {
            const senderName = msg.type === 'sent' ? 'ë‚˜' : msg.sender;
            htmlContent += `<span class="message-sender">${senderName}</span>`;
        }

        // 1. ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì¶”ê°€
        if (msg.image) {
            htmlContent += `<img src="${msg.image}" alt="ì²¨ë¶€ ì´ë¯¸ì§€" />`;
        }

        // 2. í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ ì¶”ê°€
        if (msg.text) {
            htmlContent += `<span>${msg.text}</span>`;
        }

        // 3. ì‹œê°„ (ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì œì™¸)
        if (msg.type !== 'system') {
            htmlContent += `<span class="message-time">${msg.time}</span>`;
        }

        messageDiv.innerHTML = htmlContent;
        messagesContainer.appendChild(messageDiv);
    }

    function addStatusRequestMessageToDOM(request) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', 'status-request');
        messageDiv.dataset.requestId = request.requestId;
        
        const htmlContent = `
            <div class="status-request-text">
                ğŸ’¬ ${request.userName}ë‹˜ì´ ê±°ë˜ ìƒíƒœë¥¼ '<strong>${request.statusText}</strong>'(ìœ¼)ë¡œ ë³€ê²½í•˜ê¸¸ ì›í•©ë‹ˆë‹¤.
            </div>
            <div class="status-request-buttons">
                <button class="status-request-btn accept" onclick="respondToStatusChange('${request.requestId}', true)">
                    âœ… ìˆ˜ë½
                </button>
                <button class="status-request-btn reject" onclick="respondToStatusChange('${request.requestId}', false)">
                    âŒ ê±°ë¶€
                </button>
            </div>
        `;
        
        messageDiv.innerHTML = htmlContent;
        messagesContainer.appendChild(messageDiv);
    }

    function respondToStatusChange(requestId, accepted) {
        if (!pendingStatusChange) return;

        // ë²„íŠ¼ ë¹„í™œì„±í™”
        const requestDiv = document.querySelector(`[data-request-id="${requestId}"]`);
        if (requestDiv) {
            const buttons = requestDiv.querySelectorAll('.status-request-btn');
            buttons.forEach(btn => btn.disabled = true);
        }

        // ì„œë²„ë¡œ ì‘ë‹µ ì „ì†¡
        socket.emit('respond_status_change', {
            room: currentRoomId,
            requestId: requestId,
            accepted: accepted,
            status: pendingStatusChange.status,
            user: myUserId
        });

        // ë³¸ì¸ í™”ë©´ì— ê²°ê³¼ í‘œì‹œ
        if (accepted) {
            currentStatus = pendingStatusChange.status;
            statusSelect.value = pendingStatusChange.status;
            addMessageToDOM({
                type: 'system',
                text: `ê±°ë˜ ìƒíƒœê°€ '${getStatusText(pendingStatusChange.status)}'(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`
            });
        } else {
            addMessageToDOM({
                type: 'system',
                text: `ê±°ë˜ ìƒíƒœ ë³€ê²½ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.`
            });
        }
        
        pendingStatusChange = null;
        scrollToBottom();
    }

    // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (onclickì—ì„œ ì‚¬ìš©)
    window.respondToStatusChange = respondToStatusChange;

    function updateLastMessage(roomId, text) {
        const roomItem = document.querySelector(`[data-room-id="${roomId}"]`);
        if (roomItem) {
            const lastMessageElement = roomItem.querySelector('.room-last-message');
            lastMessageElement.textContent = text;
        }
    }

    function scrollToBottom() {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function getStatusText(status) {
        switch(status) {
            case 'PENDING': return 'í˜‘ì˜ì¤‘';
            case 'IN_PERSON': return 'ì§ê±°ë˜ì¤‘';
            case 'SHIPPING': return 'ë°°ì†¡ì¤‘';
            case 'CANCELED': return 'ê±°ë˜ì·¨ì†Œ';
            case 'COMPLETED': return 'ê±°ë˜ì™„ë£Œ';
            default: return status;
        }
    }
</script>